#!/bin/bash -l

cd /corpusbuilder

if [[ "$*" == *--init* ]]; then
  bundle
  yarn
  [[ ! -f public/packs/client.js ]] && bundle exec rails webpacker:compile
fi

if [[ "$*" == *--migrate* ]]; then
  bundle exec rails db:migrate
fi

if [[ "$*" == *--run* ]]; then
  bundle exec rails server -p $CORPUS_BUILDER_PORT -b '0.0.0.0' --pid `pwd`/tmp/pids/`date +'%s'`.pid
fi
