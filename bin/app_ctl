#!/bin/bash -l

cd /corpusbuilder

if [[ "$*" == *--copy-tesseract-models* ]]; then
  cp -r /ocr/share/tessdata/* /home/corpusbuilder/tesseract/tessdata/
fi

if [[ "$*" == *--init* ]]; then
  bundle
  yarn
  [[ ! -f public/packs/client.js ]] && bundle exec rails webpacker:compile
fi

if [[ "$*" == *--migrate* ]]; then
  bundle exec rails db:migrate
fi

if [[ "$*" == *--seed* ]]; then
  bundle exec rails db:seed
fi

if [[ "$*" == *--jobs* ]]; then
  bundle exec rails jobs:work
fi

if [[ "$*" == *--repl* ]]; then
  bundle exec rails c
fi

if [[ "$*" == *--run* ]]; then
  bundle exec rails server -p $CORPUS_BUILDER_PORT -b '0.0.0.0' --pid `pwd`/tmp/pids/`date +'%s'`.pid
fi
