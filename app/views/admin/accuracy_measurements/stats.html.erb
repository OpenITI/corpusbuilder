<% title = "Accuracy Metrics Report" %>

<% content_for(:title, title) %>

<header class="content-header">
  <div class="content-header-title">
    <h1>
      <%= title %>
    </h1>
  </div>
</header>

<div class="main-content-area">
  <div class="main-content-container"><div class="main-content">
      <div class="table-container">
        <h4>Setup</h4>
        <table class="trestle-table">
          <tbody>
            <tr>
              <td><b>OCR Backend</b></td>
              <td>
                <%= @measurement.ocr_model.backend.to_s.titleize %>
              </td>
            </tr>
            <tr>
              <td><b>OCR Model</b></td>
              <td>
                <b><%= @measurement.ocr_model.name %></b>
                <br />
                version: <%= @measurement.ocr_model.version_code %>
              </td>
            </tr>
            <tr>
              <td><b>Boostrapping</b></td>
              <td>
                Samples: <%= @measurement.bootstrap_number %>
                <br />
                Sample size: <%= @measurement.bootstrap_sample_size %>
              </td>
            </tr>
            <tr>
              <td><b>Updated at</b></td>
              <td>
                <%= time_ago_in_words @measurement.updated_at %> ago
              </td>
            </tr>
          </tbody>
        </table>
        <br />
        <hr />
        <br />
        <h4>General metrics</h4>
        <table class="trestle-table">
          <thead>
            <tr>
              <th>Scope</th>
              <th>Accuracy</th>
              <th>Normalized grapheme-level edit distance</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>All documents</td>
              <td><%= '%.2f%' % ((1 - @measurement.confusion_matrix.normalized_edit_distance) * 100) %></td>
              <td><%= @measurement.confusion_matrix.normalized_edit_distance %></td>
            </tr>
            <% @measurement.accuracy_document_measurements.each do |dm| %>
              <tr>
                <td><%= link_to dm.document.title, trestle.edit_documents_admin_path(id: dm.document.id) %></td>
                <td><%= '%.2f%' % ((1 - dm.confusion_matrix.normalized_edit_distance) * 100) %></td>
                <td><%= dm.confusion_matrix.normalized_edit_distance %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
        <br />
        <hr />
        <br />
        <h4>Confusion Matrix</h4>
        <%= summary_matrix \
          confusion_matrix: @measurement.confusion_matrix,
          mode: :score
        %>
      </div>
    </div>
  </div>
</div>
